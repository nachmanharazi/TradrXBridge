# ResetAndInstallDocker.ps1
Write-Host "📦 איפוס מוחלט והתקנה של Docker..." -ForegroundColor Cyan

# שלב 1: מחיקת כל התקנה ישנה
$pathsToDelete = @(
  "C:\Program Files\Docker",
  "$env:USERPROFILE\AppData\Local\Docker",
  "$env:USERPROFILE\AppData\Roaming\Docker"
)

foreach ($path in $pathsToDelete) {
  if (Test-Path $path) {
    Remove-Item -Recurse -Force $path
    Write-Host "🧹 נמחק: $path" -ForegroundColor Yellow
  } else {
    Write-Host "✔️ לא נמצא (כבר נקי): $path" -ForegroundColor Green
  }
}

# שלב 2: בדיקת WSL2
Write-Host "🔍 בודק ש־WSL2 מותקן..." -ForegroundColor Cyan
$wslInstalled = wsl.exe --version -ErrorAction SilentlyContinue

if (-not $?) {
  Write-Host "❗ WSL2 לא מותקן. פתח PowerShell כמנהל והרץ: wsl --install" -ForegroundColor Red
  exit
} else {
  Write-Host "✅ WSL2 מותקן." -ForegroundColor Green
}

# שלב 3: הורדת Docker Installer
$installerUrl = "https://desktop.docker.com/win/main/amd64/Docker%20Desktop%20Installer.exe"
$installerPath = "$env:TEMP\DockerInstaller.exe"
Write-Host "⬇️ מוריד את Docker..." -ForegroundColor Cyan

Invoke-WebRequest -Uri $installerUrl -OutFile $installerPath

if (-Not (Test-Path $installerPath)) {
  Write-Host "❌ הורדה נכשלה." -ForegroundColor Red
  exit
}

Write-Host "✅ ההורדה הסתיימה." -ForegroundColor Green

# שלב 4: התקנה מחדש
Write-Host "🚀 מתקין Docker עם הרשאות מנהל..." -ForegroundColor Cyan

Start-Process -FilePath $installerPath -ArgumentList "install --quiet --accept-license" -Verb RunAs -Wait

# שלב 5: בדיקת Docker
Start-Sleep -Seconds 10
Write-Host "🧪 בודק אם Docker מותקן כראוי..." -ForegroundColor Cyan

$dockerVersion = & "$env:ProgramFiles\Docker\Docker\resources\bin\docker.exe" --version 2>$null

if ($dockerVersion) {
  Write-Host "✅ Docker הותקן בהצלחה:" -ForegroundColor Green
  Write-Host $dockerVersion -ForegroundColor White
} else {
  Write-Host "❌ Docker עדיין לא מזוהה. ייתכן שצריך הפעלה מחדש." -ForegroundColor Red
}

Write-Host "🔁 מומלץ להפעיל את המחשב מחדש עכשיו." -ForegroundColor Yellow

